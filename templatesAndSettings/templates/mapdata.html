<!--check this for options https://docs.djangoproject.com/en/1.4/obsolete/admin-css/




-->

{% extends "admin/base_site.html" %}
{% load admin_extras %}
{% load staticfiles %}
{% load static %}



{% load i18n admin_static admin_shortcuts_tags %}

{# django-admin-shortcuts changes these blocks #}

{% block breadcrumbs %}
    {% if authenticated %}
        <div class="admin_shortcuts">
            {% admin_shortcuts %}
        </div>
    {% endif %}
{% endblock %}

{% block extrastyle %}
    <style type="text/css">{% admin_shortcuts_css %}</style>
	{{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}"/>

	{% endblock %}


{% block extrahead %}<script src="https://use.fontawesome.com/57b6c04fb7.js"></script>
    {{ block.super }}<title>
    {% block title %}{% endblock %}
</title>
     <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css"/>
    <script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>
	<link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
	<link rel="stylesheet" href="http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css" />
	<script src="http://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">
	
	<style>
        .my-div-icon {
            color: green;
		
        }
		.my-div-pit {
            color: blue;
		
        }
		.leaflet-google-layer {
            z-index: 0;
        }
        .leaflet-map-pane {
            z-index: 100;
        }

        html, body{
            width:100%;
            height:100%;
        }
    </style>
    {% admin_shortcuts_js %}{% endblock %}

{# end changes #}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}




{% block content %}

    <div id='content-main'> {% csrf_token %}</div>
    <h1>Map the Data!</h1>
    <div style="width:100%; height:900px;" id="map"></div>
    <script type='text/javascript'>
			
        // Create Map and set view to LatLong: 40.5768984073, -75.3840872376 with zoom level 7
        var myMap = L.map('map').setView([ 18.28263, -65.77458], 14);
		//var results = {{ results | safe }};
        var osm = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
            maxZoom: 22,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>', id: 'mapbox.streets'
        }).addTo(myMap);
		//http://fontawesome.io/examples/
		var markerClusters = L.markerClusterGroup(singleMarkerMode=true);
		{% for site in features %}
			{% if  site.sampling_feature_type.name == "Site" or site.sampling_feature_type.name == "Observation well" %}
				var m = L.marker({{ site.featuregeometry|get_lat_lng }},{icon: new L.DivIcon({className: 'my-div-icon',
        html: '<i class="fa fa-map fa-2x" aria-hidden="true"></i>'+
              '<div class="my-div-span">{{ site.samplingfeaturecode }}</div>'})}
				,{title: "{{site.samplingfeaturecode}}"}).addTo(myMap).bindPopup(
						'<p>Sampling Feature Code: {{ site.samplingfeaturecode }}<br> values {{result.valuecount}}'
						+ '<br>Coordinates: {{ site.featuregeometry|get_lat_lng }}'+
						'<br> {{ site.sampling_feature_type}}<br> <a  target="_blank" href="{{prefixpath}}../graphfa/samplingfeature&#61;{{site.samplingfeatureid}}/startdate=2016-03-01/enddate=2016-03-10">view times series data in new page</a></p><iframe  width=600, height=600, src="{{prefixpath}}../graphfa/samplingfeature&#61;{{site.samplingfeatureid}}/startdate=2016-03-01/enddate=2016-03-10/popup=true" name="iframe_A"></iframe>',{minWidth: 600, maxHeight: 500, autoPan: true, closeButton: true,offset: [0, 100]} 
						
				); //.addTo(myMap)
				//markerClusters.addLayer(m);
				{% else %}
				var m = L.marker({{ site.featuregeometry|get_lat_lng }},{icon: new L.DivIcon({className: 'my-div-pit',
        html: '<i class="fa fa-leaf fa-2x" aria-hidden="true"></i>'+
              '<div class="my-div-span">{{ site.samplingfeaturecode }}</div>'})}
				,{title: "{{site.samplingfeaturecode}}"}).bindPopup(
						'<p>Sampling Feature Code: {{ site.samplingfeaturecode }}<br>'
						+ '<br>Coordinates: {{ site.featuregeometry|get_lat_lng }}'+
						'<br> {{ site.sampling_feature_type}}<br></p>',{autoPan: true, closeButton: true,}); //.addTo(myMap)
				markerClusters.addLayer(m);
				{% endif %}
				
		{% endfor %}
		
		
		

        // Basemaps Choices
        basemaps = {
            'OSM': osm
        };
		myMap.addLayer(markerClusters);
        // Overlay Choices
        overlayMaps = {};

        // Put Control on map
        L.control.layers(basemaps, overlayMaps).addTo(myMap);

    </script>


{% endblock %}